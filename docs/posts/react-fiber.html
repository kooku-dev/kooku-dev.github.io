<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no"/><link rel="shortcut icon" href="/favicon.ico"/><script>
            (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
            })(window,document,'script','dataLayer','GTM-KDDR59L');
              </script><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-88SF4487LG"></script><script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-88SF4487LG');
              </script><title>Kooku&#x27;s log - React fiber &amp; reconciliation</title><meta property="og:logo" content="https://kooku94.github.io/favicon.ico"/><meta property="og:title" content="React fiber &amp; reconciliation"/><meta property="og:image" content="https://kooku94.github.io/images/react-fiber-cover.jpeg"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="630"/><meta property="og:type" content="article"/><meta name="next-head-count" content="14"/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-6ea43f52d44630a19477.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.b4f0be21e3e8c82dd407.js" as="script"/><link rel="preload" href="/_next/static/chunks/b6d3ae6728fbe7f18c7a496885d917c502ef8a97.f1fb57fac8faffcae7e5.js" as="script"/><link rel="preload" href="/_next/static/chunks/82588f7d1c9cede2e30aa92ab94d8815bd9a75a3.d8beab73fc47c8ecaab9.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-2cd9b9378ad45e0c3d1d.js" as="script"/><link rel="preload" href="/_next/static/chunks/b2e984c5.dde205419b836c367968.js" as="script"/><link rel="preload" href="/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.0d2a9ee544564bfee014.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bslug%5D-dc9389b4382be6e937d8.js" as="script"/></head><body><div id="__next"><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KDDR59L" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><style data-emotion="css-global 1g30n2o">*{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;box-sizing:border-box;}html,body{font-family:'Spoqa Han Sans Neo',sans-serif!important;margin:0;padding:0;border:0;}html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,menu,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,main,menu,nav,output,ruby,section,summary,time,mark,audio,video{margin:0;padding:0;border:0;vertical-align:baseline;}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section{display:block;}*[hidden]{display:none;}body{line-height:1;}input::-ms-clear,input::-ms-reveal{display:none;width:0;height:0;}input::-webkit-search-decoration,input::-webkit-search-cancel-button,input::-webkit-search-results-button,input::-webkit-search-results-decoration{display:none;}*:active{-webkit-tap-highlight-color:transparent;outline:none;}*:focus{outline:0;}a{-webkit-text-decoration:none;text-decoration:none;}input[type='number']::-webkit-outer-spin-button,input[type='number']::-webkit-inner-spin-button{-webkit-appearance:none;margin:0;}button,*[role='button']{cursor:pointer;}</style><style data-emotion="css bjn8wh">.css-bjn8wh{position:relative;}</style><div class="css-bjn8wh ep629fi11"><style data-emotion="css 1mwsm5">.css-1mwsm5{background:linear-gradient(72deg, #6ecaf5, #e7c6f1);position:-webkit-sticky;position:sticky;left:0;right:0;top:0;z-index:999;}</style><div class="css-1mwsm5 e1ohtyx52"><style data-emotion="css 1518suw">.css-1518suw{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:60px;}@media (min-width: 1024px){.css-1518suw{max-width:1024px;margin:0 auto;}}@media (min-width: 768px) and (max-width: 1023px){.css-1518suw{max-width:960px;margin:0 32px;}}@media (max-width: 767px){.css-1518suw{max-width:100%;margin:0 16px;}}</style><nav class="css-1518suw e1ohtyx51"><style data-emotion="css itptq8">.css-itptq8{color:#ffffff;opacity:0.7;font-size:28px;font-weight:800;}</style><h3 role="button" tabindex="0" class="css-itptq8 e1ohtyx50">Kooku&#x27;s log</h3><style data-emotion="css 1p39xhz">.css-1p39xhz{float:right;padding:14px;opacity:0.6;}</style><a href="https://github.com/kooku94" aria-label="GitHub" class="css-1p39xhz"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg></a></nav></div><style data-emotion="css 15jvohm">@media (min-width: 1024px){.css-15jvohm{max-width:1024px;margin:auto;}}@media (min-width: 768px) and (max-width: 1023px){.css-15jvohm{margin:0 16px;}}</style><article class="css-15jvohm ep629fi9"><style data-emotion="css 8atqhb">.css-8atqhb{width:100%;}</style><div class="css-8atqhb e111c59q1"><style data-emotion="css bhtwl5">.css-bhtwl5{position:relative;}.css-bhtwl5::after{background-color:#f6f7f9;display:block;content:'';padding-bottom:calc(100% * (6.6 / 13));}.css-bhtwl5>img{position:absolute;left:0;top:0;width:100%;height:100%;}</style><div class="css-bhtwl5 e111c59q0"><img src="/images/react-fiber-cover.jpeg" alt="cover" width="123" height="82" loading="lazy"/></div></div><style data-emotion="css 1cfjemv">.css-1cfjemv{position:relative;padding-bottom:32px;}@media (min-width: 1024px){.css-1cfjemv{max-width:780px;margin:0 auto;}}@media (min-width: 768px) and (max-width: 1023px){.css-1cfjemv{max-width:780px;margin:0 32px;}}@media (max-width: 767px){.css-1cfjemv{max-width:100%;}}@media (max-width: 767px){.css-1cfjemv{margin:0 16px;}}</style><section class="css-1cfjemv ep629fi8"><style data-emotion="css 1d0nbku">.css-1d0nbku{margin-top:24px;}</style><div class="css-1d0nbku ep629fi7"><style data-emotion="css tl449l">.css-tl449l{color:#8d949f;font-size:14px;font-weight:bold;line-height:1.57;margin-right:8px;}</style><span class="css-tl449l ep629fi6">React</span></div><header><style data-emotion="css ljp8x3">.css-ljp8x3{color:#000000;margin:8px 0 24px 0;font-size:26px;font-weight:bold;line-height:1.2;}</style><h1 class="css-ljp8x3 ep629fi5">React fiber &amp; reconciliation</h1></header><style data-emotion="css 1829sa1">.css-1829sa1{color:#535a65;font-size:16px;font-weight:normal;line-height:1.63;min-height:320px;}</style><div class="css-1829sa1 ep629fi4"><style data-emotion="css 16cgglh">.css-16cgglh time{color:#9b9b9b;}.css-16cgglh p{line-height:1.5rem;margin:1rem 0 0 0;}.css-16cgglh a{font-size:1rem;color:#358cd6;-webkit-text-decoration:underline;text-decoration:underline;}.css-16cgglh h1{font-size:2rem;margin:2.5rem 0 0 0;}.css-16cgglh h2,.css-16cgglh h3,.css-16cgglh h4,.css-16cgglh h5{margin:1.5rem 0 0.5rem 0;line-height:1.25em;}.css-16cgglh h2::before{position:absolute;margin-left:-1em;font-weight:300;font-size:1.5rem;color:#9b9b9b;display:none;content:'#';}.css-16cgglh img{width:100%;}.css-16cgglh table{max-width:100%;border-spacing:0;margin-top:1.5rem;}.css-16cgglh table thead{background:#f7f7f7;}.css-16cgglh table th{font-weight:500;}.css-16cgglh table th,.css-16cgglh table td{padding:0.5em 1em;border:1px double #eee;}.css-16cgglh ul{list-style-type:disc;}.css-16cgglh ol{list-style-type:decimal;}.css-16cgglh ul ul,.css-16cgglh ol ul{list-style-type:circle;}.css-16cgglh blockquote{border-left:3px solid rgb(239, 240, 244);margin:15px 0;padding-left:16px;}.css-16cgglh blockquote p{margin-top:0;}.css-16cgglh ol,.css-16cgglh ul{padding:0 0 0 1.5rem;margin:1.5rem 0 0 0;margin:0;}.css-16cgglh ol li,.css-16cgglh ul li{line-height:1.5rem;margin:0;}.css-16cgglh .youtube-container{position:relative;width:100%;height:0;padding-bottom:56.25%;overflow:hidden;margin:20px 0;}.css-16cgglh .youtube-container iframe{width:100%;height:100%;position:absolute;top:0;left:0;}.css-16cgglh iframe{position:absolute;top:0;left:0;width:100%;height:100%;}.css-16cgglh p>code{padding:0.1rem 0.3rem;border-radius:4px;background-color:#f2f5fc;color:#275fc8;font-size:1rem;font-weight:bold;}.css-16cgglh pre{padding:1.2em;margin:1.5em 0;overflow:auto;border-radius:0.6em;color:#e0e0e0;background:#212121;font-family:'Consolas','Monaco','Andale Mono','Ubuntu Mono',monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;font-size:13px;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;-ms-overflow-style:none;overflow:-moz-scrollbars-none;}.css-16cgglh code[class*='language-'],.css-16cgglh pre[class*='language-']{color:#e0e0e0;background:none;font-family:'Consolas','Monaco','Andale Mono','Ubuntu Mono',monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.6;font-size:13px;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;-ms-overflow-style:none;overflow:-moz-scrollbars-none;}.css-16cgglh pre[class*='language-']::-webkit-scrollbar{display:none;}.css-16cgglh pre[class*='language-']{padding:1.2em;margin:1.5em 0;overflow:auto;border-radius:0.6em;}.css-16cgglh:not(pre)>code[class*='language-'],.css-16cgglh pre[class*='language-']{background:#212121;}.css-16cgglh:not(pre)>code[class*='language-']{padding:0.1em 0.6em;border-radius:0.2em;white-space:normal;background:$inline-dimmed-color;color:$inline-text-color;}.css-16cgglh .token.comment,.css-16cgglh .token.block-comment,.css-16cgglh .token.prolog,.css-16cgglh .token.doctype,.css-16cgglh .token.cdata{color:#868282;}.css-16cgglh .token.punctuation{color:#e0e0e0;}.css-16cgglh pre[class*='language-'] .tag{color:#358cd6;}.css-16cgglh .token.attr-name{color:#6196cc;}.css-16cgglh .token.namespace,.css-16cgglh .token.deleted{color:#e2777a;}.css-16cgglh .token.function-name{color:#6196cc;}.css-16cgglh .token.boolean{color:#358cd6;}.css-16cgglh .token.number{color:#b5ce98;}.css-16cgglh .token.function{color:#dcdcaa;}.css-16cgglh .token.property,.css-16cgglh .token.class-name,.css-16cgglh .token.constant,.css-16cgglh .token.symbol{color:#4ec9b2;}.css-16cgglh .token.selector,.css-16cgglh .token.important,.css-16cgglh .token.atrule,.css-16cgglh .token.keyword,.css-16cgglh .token.builtin{color:#c586c0;}.css-16cgglh .token.string,.css-16cgglh .token.char,.css-16cgglh .token.attr-value,.css-16cgglh .token.regex,.css-16cgglh .token.variable{color:#ce9178;}.css-16cgglh .token.operator,.css-16cgglh .token.entity,.css-16cgglh .token.url{color:#67cdcc;}.css-16cgglh .token.important,.css-16cgglh .token.bold{font-weight:bold;}.css-16cgglh .token.italic{font-style:italic;}.css-16cgglh .token.entity{cursor:help;}.css-16cgglh .token.inserted{color:green;}</style><div class="css-16cgglh ep629fi3"><h1>React reconciliation</h1>
<p>Reconciliation은 React의 "비교(diffing)" 알고리즘입니다. 이 비교 알고리즘 덕분에 컴포넌트의 갱신이 예측 가능해지면서도 고성능 앱이라고 불러도 손색없을 만큼 충분히 빠른 앱을 만들 수 있습니다</p>
<h3><a href="https://github.com/kooku94/kooku-s-log/blob/master/content/blog/react/react-reconciliation-%26-fiber.md#react-rendering-logic"></a>React rendering logic</h3>
<p>리액트 컴포넌트가 화면에 렌더링 되는 과정은 다음과 같습니다.</p>
<ol>
<li>리액트의 JSX가 <code>React.createElement</code>로 바벨에 의해 트랜스파일링됨</li>
<li><code>React.createElement</code>함수 호출에 의해 리액트 엘리먼트 트리가 반환됨</li>
<li>React의 <code>reconciliation</code> 알고리즘에 의해 리액트 엘리먼트 트리를 재귀적으로 순회하면서 이전 트리와 현재 트리의 변경사항을 비교한다음 변경된 부분만 실제 DOM에 반영함 (Virtual-DOM)</li>
</ol>
<h2><a href="https://github.com/kooku94/kooku-s-log/blob/master/content/blog/react/react-reconciliation-%26-fiber.md#overview"></a>Overview</h2>
<p>React를 사용하다 보면, "<code>render()</code> 함수는 React 엘리먼트 트리를 만드는 것이다." 라고 생각이 드는 순간이 있습니다. state나 props가 갱신되면 <code>render()</code>함수는 새로운 React 엘리먼트 트리를 반환하기 때문입니다. 이때 React는 방금 반환된 트리에 맞게 가장 효과적으로 UI를 갱신하는 방법을 알아야할 필요가 있습니다.</p>
<p>하나의 트리를 가지고 다른 트리로 변환하기 위한 최소한의 연산 수를 구하는 알고리즘 문제를 풀기 위한 일반적인 해결책들은 n개의 엘리먼트가 있는 트리에 대해 O(n^3)의 복잡도를 가집니다.</p>
<p>React에 이 알고리즘을 적용한다면, 1000개의 엘리먼트를 그리기 위해 10억 번의 비교 연산을 수행해야합니다. 이를 대체하기 위해 React는 두 가지 가정을 기반하여 O(n) 복잡도의 휴리스틱 알고리즘을 구현했습니다.</p>
<ol>
<li>서로 다른 타입의 두 엘리먼트는 서로 다른 트리를 만들어낸다.</li>
<li>개발자가 <code>key</code> prop을 통해, 여러 렌더링 사이에서 어떤 자식 엘리먼트가 변경되지 않아야 할지 표시해 줄 수 있다.</li>
</ol>
<p>실제로 거의 모든 사용 사례에서 이 가정들은 들어맞습니다.</p>
<h2><a href="https://github.com/kooku94/kooku-s-log/blob/master/content/blog/react/react-reconciliation-%26-fiber.md#%EB%B9%84%EA%B5%90-%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98-diffing-algorithm"></a>비교 알고리즘 (Diffing Algorithm)</h2>
<p>두 개의 트리를 비교할 때, React는 두 엘리먼트의 루트(root) 엘림먼트부터 비교합니다. 이후의 동작은 루트 엘리먼트 타입에 따라 달라집니다.</p>
<h3><a href="https://github.com/kooku94/kooku-s-log/blob/master/content/blog/react/react-reconciliation-%26-fiber.md#%EC%97%98%EB%A6%AC%EB%A8%BC%ED%8A%B8%EC%9D%98-%ED%83%80%EC%9E%85%EC%9D%B4-%EB%8B%A4%EB%A5%B8-%EA%B2%BD%EC%9A%B0"></a>엘리먼트의 타입이 다른 경우</h3>
<p>두 루트 엘리먼트의 타입이 다르면, React는 이전 트리를 버리고 완전히 새로운 트리를 구축합니다. <code>&#x3C;a></code> 에서 <code>&#x3C;img></code>로 바뀌는 등 트리 전체를 재구축하는 경우입니다.</p>
<p>트리를 버릴 때 이전 DOM 노드들은 모두 파괴됩니다. 컴포넌트 인스턴스는 <code>componentWillUnmount()</code>가 실행됩니다. 새로운 트리가 만들어 질 때, 새로운 DOM 노드들이 DOM에 삽입됩니다. 그에 따라 컴포넌트 인스턴스는 <code>componentDidWillMount()</code>가 실행됩니다. 이전 트리와 연관된 모든 state는 사라집니다.</p>
<p>루트 엘리먼트 아래의 모든 컴포넌트도 언마운트되고 그 state도 사라집니다. 예를 들어, 아래와 같은 비교가 일어나면,</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">Counter</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>span</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span><span class="token class-name">Counter</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>span</span><span class="token punctuation">></span></span>
</code></pre>
<p>이전 <code>Counter</code>는 사라지고, 새로 다시 마운트가 될 것입니다.</p>
<h3><a href="https://github.com/kooku94/kooku-s-log/blob/master/content/blog/react/react-reconciliation-%26-fiber.md#dom-%EC%97%98%EB%A6%AC%EB%A8%BC%ED%8A%B8%EC%9D%98-%ED%83%80%EC%9E%85%EC%9D%B4-%EA%B0%99%EC%9D%80-%EA%B2%BD%EC%9A%B0"></a>DOM 엘리먼트의 타입이 같은 경우</h3>
<p>같은 타입의 두 React DOM 엘리먼트를 비교할 때, React는 두 엘리먼트의 속성을 확인하여, 동일한 내역은 유지하고 변경된 속성들만 갱신합니다. 예를 들어,</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>before<span class="token punctuation">"</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stuff<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>after<span class="token punctuation">"</span></span> <span class="token attr-name">title</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stuff<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
</code></pre>
<p>이 두 엘리먼트를 비교하면, React는 현재 DOM 노드 상에 <code>className</code>만 수정합니다.</p>
<p><code>style</code>이 갱신될 때, React는 또한 변경된 속성만을 갱신합니다. 예를 들어,</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>color<span class="token operator">:</span> <span class="token string">'red'</span><span class="token punctuation">,</span> fontWeight<span class="token operator">:</span> <span class="token string">'bold'</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">style</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>color<span class="token operator">:</span> <span class="token string">'green'</span><span class="token punctuation">,</span> fontWeight<span class="token operator">:</span> <span class="token string">'bold'</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span> <span class="token punctuation">/></span></span>
</code></pre>
<p>위 두 엘리먼트 사이에서 변경될 때, <code>fontWeight</code>는 수정하지 않고 <code>color</code>속성 만을 수정합니다.</p>
<p>DOM 노드의 처리가 끝나면, React는 이어서 해당 노드의 자식들을 재귀적으로 처리합니다.</p>
<h2><a href="https://github.com/kooku94/kooku-s-log/blob/master/content/blog/react/react-reconciliation-%26-fiber.md#%EC%9E%90%EC%8B%9D%EC%97%90-%EB%8C%80%ED%95%9C-%EC%9E%AC%EA%B7%80%EC%A0%81-%EC%B2%98%EB%A6%AC"></a>자식에 대한 재귀적 처리</h2>
<p>DOM 노드의 자식들을 재귀적으로 처리할 때, React는 기본적으로 동시에 두 리스트를 순회하고 차이점이 있으면 변경을 생성합니다.</p>
<p>예를 들어, 자식의 끝에 엘리먼트를 추가하면, 두 트리 사이의 변경은 잘 작동할 것입니다.</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">first</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">second</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>ul</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">first</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">second</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">third</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>ul</span><span class="token punctuation">></span></span>
</code></pre>
<p>React는 두 트리에서 <code>&#x3C;li>first&#x3C;/li></code>가 일치하는 것을 확인하고, <code>&#x3C;li>second&#x3C;/li></code>가 일치하는 것을 확인합니다. 그리고 마지막으로 <code>&#x3C;li>third&#x3C;/li></code>를 트리에 추가합니다.</p>
<p>하지만 위와 같이 단순하게 구현하면, 트리의 맨 앞에 엘리먼트를 추가하는 경우 성능이 좋지 않습니다. 예를 들어, 아래의 두 트리 변환은 형편없이 작동합니다.</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">Duke</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">Villanova</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>ul</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">Connecticut</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">Duke</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">Villanova</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>ul</span><span class="token punctuation">></span></span>
</code></pre>
<p>React는 <code>&#x3C;li>Duke&#x3C;/li></code>와 <code>&#x3C;li>Villanova&#x3C;/li></code> 종속 트리를 그대로 유지하는 대신 모든 자식을 변경합니다. 이러한 비효율은 문제가 될 수 있습니다.</p>
<h3><a href="https://github.com/kooku94/kooku-s-log/blob/master/content/blog/react/react-reconciliation-%26-fiber.md#keys"></a>Keys</h3>
<p>이러한 문제를 해결하기 위해, React는 <code>key</code> 속성을 지원합니다. 자식들이 key를 가지고 있다면, React는 key를 통해 기존 트리와 이후 트리의 자식들이 일치하는지 확인합니다. 예를 들어, 위 비효율적인 예시에 <code>key</code>를 추가하여 트리의 변환 작업이 효율적으로 수행되도록 수정할 수 있습니다.</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2015<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">Duke</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2016<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">Villanova</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>ul</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>ul</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2014<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">Connecticut</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2015<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">Duke</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span> <span class="token attr-name">key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2016<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">Villanova</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>ul</span><span class="token punctuation">></span></span>
</code></pre>
<p>이를 위해 데이터 구조에 ID라는 속성을 추가해주거나 데이터 일부에 해시를 적용해서 key를 생성할 수 있습니다. 해당 key는 오로지 형제 사이에서만 유일하면 되고, 전역에서 유일할 필요는 없습니다.</p>
<p>최후의 수단으로 배열의 인덱스를 key로 사용할 수 있습니다. 만약 항목들이 재배열되지 않는다면 이 방법도 잘 동작할 것이지만, 재배열되는 경우 비효율적으로 동작할 것입니다.</p>
<p>인덱스를 key로 사용 중 배열이 재배열되면 컴포넌트의 state와 관련된 문제가 발생할 수 있습니다. 컴포넌트 인스턴스는 key를 기반으로 갱신되고 재사용됩니다. 인덱스를 key로 사용하면, 항목의 순서가 바뀌었을 때 key 또한 바뀔 것입니다. 그 결과로, 컴포넌트의 state가 엉망이 되거나 의도하지 않은 방식으로 바뀔 수도 있습니다.</p>
<h1><a href="https://github.com/kooku94/kooku-s-log/blob/master/content/blog/react/react-reconciliation-%26-fiber.md#react-fiber"></a>React Fiber</h1>
<p>React Fiber는 React v16에 포함된 새로운 reconciliation algorithm 입니다.</p>
<p>React's core algorithm을 대부분 갈아엎은 2년 이상의 연구로 만들어진 알고리즘으로 React Fiber의 목표는 animation, layout, gestures와 같은 영역에 대한 rendering을 향상시키는 것 입니다.</p>
<p>주요 특징은 <strong>incremental rendering</strong>으로 rendering work를 덩어리로 쪼갠 후 여러 프레임에서 적절히 수행시키는 것 입니다.</p>
<p>주요 포인트는 다음과 같습니다.</p>
<ul>
<li>UI에서 모든 업데이트를 즉시 적용할 필요가 없다. 실제로 그렇게 하면 frame drop과 사용자 경험이 저하될 수 있다.</li>
<li>업데이트마다 우선순위가 다르다. 애니메이션은 data update 보다 더 빨리 완료되어야한다.</li>
</ul>
<h2><a href="https://github.com/kooku94/kooku-s-log/blob/master/content/blog/react/react-reconciliation-%26-fiber.md#what-is-fiber"></a>What is fiber?</h2>
<p>UI를 다룰 때, 너무 많은 작업이 한 번에 실행될 때 문제가 생기기 마련입니다. 이럴 때 animation을 수행하게 되면 frame drop 과 사용자에게 툭툭 끊기게 보여지게 됩니다.</p>
<p>이를 해결하기 위해 작업들에 대해 우선순위를 매기고 <code>requestIdleCallback</code>은 유휴 기간 동안 낮은 우선순위 함수를 호출하도록 예약하고 <code>requestAnimationFrame</code>은 다음 animation에서 호출할 높은 우선 순위 함수를 예약하면 됩니다. 하지만 이러한 API를 사용하기 위해서는 <strong>Incremental rendering</strong>이 필요합니다. rendering 과정에는 단 하나의 call stack에만 사용하기에 스택이 비워질 때까지 다른 작업을 수행하지 않기 때문입니다.</p>
<p>UI rendering을 최적화하기 위해 call stack의 동작을 사용자 마음대로 정의할 수 있다면 좋지 않을까요? call stack을 마음대로 중단하고 stack frame을 수동으로 조작할 수 있다면 좋지 않을까요? 이것이 React Fiber의 목적입니다. Fiber는 React 컴포넌트에 특화된 stack의 재구현으로 <strong>virtual stack frame</strong>으로 생각하면 됩니다.</p>
<h2><a href="https://github.com/kooku94/kooku-s-log/blob/master/content/blog/react/react-reconciliation-%26-fiber.md#incremental-rendering"></a>Incremental rendering</h2>
<ul>
<li>pause work and come back to it later</li>
<li>assign priority to different types of work</li>
<li>reuse previously completed work</li>
<li>abort work if it's no longer needed</li>
</ul>
<p>Fiber에서는 <code>requestIdleCallback</code>을 활용해서 동작중인 React 코드를 매번 부르고, 주어진 시간을 초과한다면 멈추고 더 중요한 일에 양보합니다. 더 중요한 일이 끝나면 다시 돌아와서 나머지 작업을 완료합니다.</p>
<p>어느 시점에서나 작업을 멈출 수 있어야 한다는 것은 task가 잘게 쪼개질 수 있어야 가능해 보입니다. 그리고 이러한 작업이 Incremental task 입니다.</p>
<h1><a href="https://github.com/kooku94/kooku-s-log/blob/master/content/blog/react/react-reconciliation-%26-fiber.md#phases"></a>Phases</h1>
<h2><a href="https://github.com/kooku94/kooku-s-log/blob/master/content/blog/react/react-reconciliation-%26-fiber.md#phase-1-render--reconciliation"></a>Phase 1 (render / reconciliation)</h2>
<p>interrupible</p>
<h2><a href="https://github.com/kooku94/kooku-s-log/blob/master/content/blog/react/react-reconciliation-%26-fiber.md#phase-2-commit"></a>Phase 2 (commit)</h2>
<p>no interruptible</p>
<h2><a href="https://github.com/kooku94/kooku-s-log/blob/master/content/blog/react/react-reconciliation-%26-fiber.md#reference"></a>Reference</h2>
<ul>
<li><a href="https://ko.reactjs.org/docs/reconciliation.html">react - reconciliation</a></li>
<li><a href="https://www.youtube.com/watch?v=ZCuYPiUIONs">Lin Clark - A Cartoon Intro to Fiber - React Conf 2017</a></li>
<li><a href="https://github.com/acdlite/react-fiber-architecture">react-fiber-architecture</a></li>
</ul></div></div><style data-emotion="css 9vkh6d">.css-9vkh6d{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;width:100%;margin-top:48px;}.css-9vkh6d button{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;-webkit-justify-content:center;justify-content:center;width:240px;height:48px;border:none;margin:8px auto;border-radius:4px;font-size:16px;font-weight:bold;padding:16px;position:relative;}</style><div class="css-9vkh6d ep629fi2"><style data-emotion="css 1qw3ucq">.css-1qw3ucq{background-color:#e8f3ff;color:#1d6ff2;margin-bottom:16px;}.css-1qw3ucq>svg{position:absolute;left:16px;}</style><button class="like-button css-1qw3ucq ep629fi1"><svg viewBox="0 0 24 24" style="width:20;height:20" role="presentation" class="like-button"><path d="M12.1,18.55L12,18.65L11.89,18.55C7.14,14.24 4,11.39 4,8.5C4,6.5 5.5,5 7.5,5C9.04,5 10.54,6 11.07,7.36H12.93C13.46,6 14.96,5 16.5,5C18.5,5 20,6.5 20,8.5C20,11.39 16.86,14.24 12.1,18.55M16.5,3C14.76,3 13.09,3.81 12,5.08C10.91,3.81 9.24,3 7.5,3C4.42,3 2,5.41 2,8.5C2,12.27 5.4,15.36 10.55,20.03L12,21.35L13.45,20.03C18.6,15.36 22,12.27 22,8.5C22,5.41 19.58,3 16.5,3Z" style="fill:#1d6ff2"></path></svg>LIKE</button><style data-emotion="css qkt14p">.css-qkt14p{background-color:#e5e8ec;color:#535a65;}.css-qkt14p>img{position:absolute;left:16px;}</style><button class="share-button css-qkt14p ep629fi0"><img src="/icon/share.svg" alt="share" height="20" width="20" class="share-button css-0 ep629fi10"/>SHARE</button></div></section></article></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":"React fiber \u0026 reconciliation","slug":"react-fiber","content":"\u003ch1\u003eReact reconciliation\u003c/h1\u003e\n\u003cp\u003eReconciliation은 React의 \"비교(diffing)\" 알고리즘입니다. 이 비교 알고리즘 덕분에 컴포넌트의 갱신이 예측 가능해지면서도 고성능 앱이라고 불러도 손색없을 만큼 충분히 빠른 앱을 만들 수 있습니다\u003c/p\u003e\n\u003ch3\u003e\u003ca href=\"https://github.com/kooku94/kooku-s-log/blob/master/content/blog/react/react-reconciliation-%26-fiber.md#react-rendering-logic\"\u003e\u003c/a\u003eReact rendering logic\u003c/h3\u003e\n\u003cp\u003e리액트 컴포넌트가 화면에 렌더링 되는 과정은 다음과 같습니다.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e리액트의 JSX가 \u003ccode\u003eReact.createElement\u003c/code\u003e로 바벨에 의해 트랜스파일링됨\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eReact.createElement\u003c/code\u003e함수 호출에 의해 리액트 엘리먼트 트리가 반환됨\u003c/li\u003e\n\u003cli\u003eReact의 \u003ccode\u003ereconciliation\u003c/code\u003e 알고리즘에 의해 리액트 엘리먼트 트리를 재귀적으로 순회하면서 이전 트리와 현재 트리의 변경사항을 비교한다음 변경된 부분만 실제 DOM에 반영함 (Virtual-DOM)\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2\u003e\u003ca href=\"https://github.com/kooku94/kooku-s-log/blob/master/content/blog/react/react-reconciliation-%26-fiber.md#overview\"\u003e\u003c/a\u003eOverview\u003c/h2\u003e\n\u003cp\u003eReact를 사용하다 보면, \"\u003ccode\u003erender()\u003c/code\u003e 함수는 React 엘리먼트 트리를 만드는 것이다.\" 라고 생각이 드는 순간이 있습니다. state나 props가 갱신되면 \u003ccode\u003erender()\u003c/code\u003e함수는 새로운 React 엘리먼트 트리를 반환하기 때문입니다. 이때 React는 방금 반환된 트리에 맞게 가장 효과적으로 UI를 갱신하는 방법을 알아야할 필요가 있습니다.\u003c/p\u003e\n\u003cp\u003e하나의 트리를 가지고 다른 트리로 변환하기 위한 최소한의 연산 수를 구하는 알고리즘 문제를 풀기 위한 일반적인 해결책들은 n개의 엘리먼트가 있는 트리에 대해 O(n^3)의 복잡도를 가집니다.\u003c/p\u003e\n\u003cp\u003eReact에 이 알고리즘을 적용한다면, 1000개의 엘리먼트를 그리기 위해 10억 번의 비교 연산을 수행해야합니다. 이를 대체하기 위해 React는 두 가지 가정을 기반하여 O(n) 복잡도의 휴리스틱 알고리즘을 구현했습니다.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e서로 다른 타입의 두 엘리먼트는 서로 다른 트리를 만들어낸다.\u003c/li\u003e\n\u003cli\u003e개발자가 \u003ccode\u003ekey\u003c/code\u003e prop을 통해, 여러 렌더링 사이에서 어떤 자식 엘리먼트가 변경되지 않아야 할지 표시해 줄 수 있다.\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003e실제로 거의 모든 사용 사례에서 이 가정들은 들어맞습니다.\u003c/p\u003e\n\u003ch2\u003e\u003ca href=\"https://github.com/kooku94/kooku-s-log/blob/master/content/blog/react/react-reconciliation-%26-fiber.md#%EB%B9%84%EA%B5%90-%EC%95%8C%EA%B3%A0%EB%A6%AC%EC%A6%98-diffing-algorithm\"\u003e\u003c/a\u003e비교 알고리즘 (Diffing Algorithm)\u003c/h2\u003e\n\u003cp\u003e두 개의 트리를 비교할 때, React는 두 엘리먼트의 루트(root) 엘림먼트부터 비교합니다. 이후의 동작은 루트 엘리먼트 타입에 따라 달라집니다.\u003c/p\u003e\n\u003ch3\u003e\u003ca href=\"https://github.com/kooku94/kooku-s-log/blob/master/content/blog/react/react-reconciliation-%26-fiber.md#%EC%97%98%EB%A6%AC%EB%A8%BC%ED%8A%B8%EC%9D%98-%ED%83%80%EC%9E%85%EC%9D%B4-%EB%8B%A4%EB%A5%B8-%EA%B2%BD%EC%9A%B0\"\u003e\u003c/a\u003e엘리먼트의 타입이 다른 경우\u003c/h3\u003e\n\u003cp\u003e두 루트 엘리먼트의 타입이 다르면, React는 이전 트리를 버리고 완전히 새로운 트리를 구축합니다. \u003ccode\u003e\u0026#x3C;a\u003e\u003c/code\u003e 에서 \u003ccode\u003e\u0026#x3C;img\u003e\u003c/code\u003e로 바뀌는 등 트리 전체를 재구축하는 경우입니다.\u003c/p\u003e\n\u003cp\u003e트리를 버릴 때 이전 DOM 노드들은 모두 파괴됩니다. 컴포넌트 인스턴스는 \u003ccode\u003ecomponentWillUnmount()\u003c/code\u003e가 실행됩니다. 새로운 트리가 만들어 질 때, 새로운 DOM 노드들이 DOM에 삽입됩니다. 그에 따라 컴포넌트 인스턴스는 \u003ccode\u003ecomponentDidWillMount()\u003c/code\u003e가 실행됩니다. 이전 트리와 연관된 모든 state는 사라집니다.\u003c/p\u003e\n\u003cp\u003e루트 엘리먼트 아래의 모든 컴포넌트도 언마운트되고 그 state도 사라집니다. 예를 들어, 아래와 같은 비교가 일어나면,\u003c/p\u003e\n\u003cpre class=\"language-jsx\"\u003e\u003ccode class=\"language-jsx\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ediv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n  \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eCounter\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003ediv\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003espan\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n  \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eCounter\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003espan\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이전 \u003ccode\u003eCounter\u003c/code\u003e는 사라지고, 새로 다시 마운트가 될 것입니다.\u003c/p\u003e\n\u003ch3\u003e\u003ca href=\"https://github.com/kooku94/kooku-s-log/blob/master/content/blog/react/react-reconciliation-%26-fiber.md#dom-%EC%97%98%EB%A6%AC%EB%A8%BC%ED%8A%B8%EC%9D%98-%ED%83%80%EC%9E%85%EC%9D%B4-%EA%B0%99%EC%9D%80-%EA%B2%BD%EC%9A%B0\"\u003e\u003c/a\u003eDOM 엘리먼트의 타입이 같은 경우\u003c/h3\u003e\n\u003cp\u003e같은 타입의 두 React DOM 엘리먼트를 비교할 때, React는 두 엘리먼트의 속성을 확인하여, 동일한 내역은 유지하고 변경된 속성들만 갱신합니다. 예를 들어,\u003c/p\u003e\n\u003cpre class=\"language-html\"\u003e\u003ccode class=\"language-html\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ediv\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eclassName\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003ebefore\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003etitle\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003estuff\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ediv\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003eclassName\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003eafter\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003etitle\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003estuff\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이 두 엘리먼트를 비교하면, React는 현재 DOM 노드 상에 \u003ccode\u003eclassName\u003c/code\u003e만 수정합니다.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003estyle\u003c/code\u003e이 갱신될 때, React는 또한 변경된 속성만을 갱신합니다. 예를 들어,\u003c/p\u003e\n\u003cpre class=\"language-jsx\"\u003e\u003ccode class=\"language-jsx\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ediv\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003estyle\u003c/span\u003e\u003cspan class=\"token script language-javascript\"\u003e\u003cspan class=\"token script-punctuation punctuation\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003ecolor\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'red'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e fontWeight\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'bold'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003ediv\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003estyle\u003c/span\u003e\u003cspan class=\"token script language-javascript\"\u003e\u003cspan class=\"token script-punctuation punctuation\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003ecolor\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'green'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e fontWeight\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token string\"\u003e'bold'\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e/\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e위 두 엘리먼트 사이에서 변경될 때, \u003ccode\u003efontWeight\u003c/code\u003e는 수정하지 않고 \u003ccode\u003ecolor\u003c/code\u003e속성 만을 수정합니다.\u003c/p\u003e\n\u003cp\u003eDOM 노드의 처리가 끝나면, React는 이어서 해당 노드의 자식들을 재귀적으로 처리합니다.\u003c/p\u003e\n\u003ch2\u003e\u003ca href=\"https://github.com/kooku94/kooku-s-log/blob/master/content/blog/react/react-reconciliation-%26-fiber.md#%EC%9E%90%EC%8B%9D%EC%97%90-%EB%8C%80%ED%95%9C-%EC%9E%AC%EA%B7%80%EC%A0%81-%EC%B2%98%EB%A6%AC\"\u003e\u003c/a\u003e자식에 대한 재귀적 처리\u003c/h2\u003e\n\u003cp\u003eDOM 노드의 자식들을 재귀적으로 처리할 때, React는 기본적으로 동시에 두 리스트를 순회하고 차이점이 있으면 변경을 생성합니다.\u003c/p\u003e\n\u003cp\u003e예를 들어, 자식의 끝에 엘리먼트를 추가하면, 두 트리 사이의 변경은 잘 작동할 것입니다.\u003c/p\u003e\n\u003cpre class=\"language-jsx\"\u003e\u003ccode class=\"language-jsx\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eul\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n  \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eli\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003efirst\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eli\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n  \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eli\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003esecond\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eli\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eul\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eul\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n  \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eli\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003efirst\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eli\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n  \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eli\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003esecond\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eli\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n  \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eli\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003ethird\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eli\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eul\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eReact는 두 트리에서 \u003ccode\u003e\u0026#x3C;li\u003efirst\u0026#x3C;/li\u003e\u003c/code\u003e가 일치하는 것을 확인하고, \u003ccode\u003e\u0026#x3C;li\u003esecond\u0026#x3C;/li\u003e\u003c/code\u003e가 일치하는 것을 확인합니다. 그리고 마지막으로 \u003ccode\u003e\u0026#x3C;li\u003ethird\u0026#x3C;/li\u003e\u003c/code\u003e를 트리에 추가합니다.\u003c/p\u003e\n\u003cp\u003e하지만 위와 같이 단순하게 구현하면, 트리의 맨 앞에 엘리먼트를 추가하는 경우 성능이 좋지 않습니다. 예를 들어, 아래의 두 트리 변환은 형편없이 작동합니다.\u003c/p\u003e\n\u003cpre class=\"language-jsx\"\u003e\u003ccode class=\"language-jsx\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eul\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n  \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eli\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003eDuke\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eli\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n  \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eli\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003eVillanova\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eli\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eul\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eul\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n  \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eli\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003eConnecticut\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eli\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n  \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eli\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003eDuke\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eli\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n  \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eli\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003eVillanova\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eli\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eul\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eReact는 \u003ccode\u003e\u0026#x3C;li\u003eDuke\u0026#x3C;/li\u003e\u003c/code\u003e와 \u003ccode\u003e\u0026#x3C;li\u003eVillanova\u0026#x3C;/li\u003e\u003c/code\u003e 종속 트리를 그대로 유지하는 대신 모든 자식을 변경합니다. 이러한 비효율은 문제가 될 수 있습니다.\u003c/p\u003e\n\u003ch3\u003e\u003ca href=\"https://github.com/kooku94/kooku-s-log/blob/master/content/blog/react/react-reconciliation-%26-fiber.md#keys\"\u003e\u003c/a\u003eKeys\u003c/h3\u003e\n\u003cp\u003e이러한 문제를 해결하기 위해, React는 \u003ccode\u003ekey\u003c/code\u003e 속성을 지원합니다. 자식들이 key를 가지고 있다면, React는 key를 통해 기존 트리와 이후 트리의 자식들이 일치하는지 확인합니다. 예를 들어, 위 비효율적인 예시에 \u003ccode\u003ekey\u003c/code\u003e를 추가하여 트리의 변환 작업이 효율적으로 수행되도록 수정할 수 있습니다.\u003c/p\u003e\n\u003cpre class=\"language-jsx\"\u003e\u003ccode class=\"language-jsx\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eul\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n  \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eli\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ekey\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e2015\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003eDuke\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eli\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n  \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eli\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ekey\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e2016\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003eVillanova\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eli\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eul\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\n\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eul\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n  \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eli\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ekey\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e2014\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003eConnecticut\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eli\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n  \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eli\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ekey\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e2015\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003eDuke\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eli\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n  \u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;\u003c/span\u003eli\u003c/span\u003e \u003cspan class=\"token attr-name\"\u003ekey\u003c/span\u003e\u003cspan class=\"token attr-value\"\u003e\u003cspan class=\"token punctuation attr-equals\"\u003e=\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e2016\u003cspan class=\"token punctuation\"\u003e\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003eVillanova\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eli\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token plain-text\"\u003e\n\u003c/span\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token tag\"\u003e\u003cspan class=\"token punctuation\"\u003e\u0026#x3C;/\u003c/span\u003eul\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e\u003e\u003c/span\u003e\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이를 위해 데이터 구조에 ID라는 속성을 추가해주거나 데이터 일부에 해시를 적용해서 key를 생성할 수 있습니다. 해당 key는 오로지 형제 사이에서만 유일하면 되고, 전역에서 유일할 필요는 없습니다.\u003c/p\u003e\n\u003cp\u003e최후의 수단으로 배열의 인덱스를 key로 사용할 수 있습니다. 만약 항목들이 재배열되지 않는다면 이 방법도 잘 동작할 것이지만, 재배열되는 경우 비효율적으로 동작할 것입니다.\u003c/p\u003e\n\u003cp\u003e인덱스를 key로 사용 중 배열이 재배열되면 컴포넌트의 state와 관련된 문제가 발생할 수 있습니다. 컴포넌트 인스턴스는 key를 기반으로 갱신되고 재사용됩니다. 인덱스를 key로 사용하면, 항목의 순서가 바뀌었을 때 key 또한 바뀔 것입니다. 그 결과로, 컴포넌트의 state가 엉망이 되거나 의도하지 않은 방식으로 바뀔 수도 있습니다.\u003c/p\u003e\n\u003ch1\u003e\u003ca href=\"https://github.com/kooku94/kooku-s-log/blob/master/content/blog/react/react-reconciliation-%26-fiber.md#react-fiber\"\u003e\u003c/a\u003eReact Fiber\u003c/h1\u003e\n\u003cp\u003eReact Fiber는 React v16에 포함된 새로운 reconciliation algorithm 입니다.\u003c/p\u003e\n\u003cp\u003eReact's core algorithm을 대부분 갈아엎은 2년 이상의 연구로 만들어진 알고리즘으로 React Fiber의 목표는 animation, layout, gestures와 같은 영역에 대한 rendering을 향상시키는 것 입니다.\u003c/p\u003e\n\u003cp\u003e주요 특징은 \u003cstrong\u003eincremental rendering\u003c/strong\u003e으로 rendering work를 덩어리로 쪼갠 후 여러 프레임에서 적절히 수행시키는 것 입니다.\u003c/p\u003e\n\u003cp\u003e주요 포인트는 다음과 같습니다.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eUI에서 모든 업데이트를 즉시 적용할 필요가 없다. 실제로 그렇게 하면 frame drop과 사용자 경험이 저하될 수 있다.\u003c/li\u003e\n\u003cli\u003e업데이트마다 우선순위가 다르다. 애니메이션은 data update 보다 더 빨리 완료되어야한다.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e\u003ca href=\"https://github.com/kooku94/kooku-s-log/blob/master/content/blog/react/react-reconciliation-%26-fiber.md#what-is-fiber\"\u003e\u003c/a\u003eWhat is fiber?\u003c/h2\u003e\n\u003cp\u003eUI를 다룰 때, 너무 많은 작업이 한 번에 실행될 때 문제가 생기기 마련입니다. 이럴 때 animation을 수행하게 되면 frame drop 과 사용자에게 툭툭 끊기게 보여지게 됩니다.\u003c/p\u003e\n\u003cp\u003e이를 해결하기 위해 작업들에 대해 우선순위를 매기고 \u003ccode\u003erequestIdleCallback\u003c/code\u003e은 유휴 기간 동안 낮은 우선순위 함수를 호출하도록 예약하고 \u003ccode\u003erequestAnimationFrame\u003c/code\u003e은 다음 animation에서 호출할 높은 우선 순위 함수를 예약하면 됩니다. 하지만 이러한 API를 사용하기 위해서는 \u003cstrong\u003eIncremental rendering\u003c/strong\u003e이 필요합니다. rendering 과정에는 단 하나의 call stack에만 사용하기에 스택이 비워질 때까지 다른 작업을 수행하지 않기 때문입니다.\u003c/p\u003e\n\u003cp\u003eUI rendering을 최적화하기 위해 call stack의 동작을 사용자 마음대로 정의할 수 있다면 좋지 않을까요? call stack을 마음대로 중단하고 stack frame을 수동으로 조작할 수 있다면 좋지 않을까요? 이것이 React Fiber의 목적입니다. Fiber는 React 컴포넌트에 특화된 stack의 재구현으로 \u003cstrong\u003evirtual stack frame\u003c/strong\u003e으로 생각하면 됩니다.\u003c/p\u003e\n\u003ch2\u003e\u003ca href=\"https://github.com/kooku94/kooku-s-log/blob/master/content/blog/react/react-reconciliation-%26-fiber.md#incremental-rendering\"\u003e\u003c/a\u003eIncremental rendering\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003epause work and come back to it later\u003c/li\u003e\n\u003cli\u003eassign priority to different types of work\u003c/li\u003e\n\u003cli\u003ereuse previously completed work\u003c/li\u003e\n\u003cli\u003eabort work if it's no longer needed\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eFiber에서는 \u003ccode\u003erequestIdleCallback\u003c/code\u003e을 활용해서 동작중인 React 코드를 매번 부르고, 주어진 시간을 초과한다면 멈추고 더 중요한 일에 양보합니다. 더 중요한 일이 끝나면 다시 돌아와서 나머지 작업을 완료합니다.\u003c/p\u003e\n\u003cp\u003e어느 시점에서나 작업을 멈출 수 있어야 한다는 것은 task가 잘게 쪼개질 수 있어야 가능해 보입니다. 그리고 이러한 작업이 Incremental task 입니다.\u003c/p\u003e\n\u003ch1\u003e\u003ca href=\"https://github.com/kooku94/kooku-s-log/blob/master/content/blog/react/react-reconciliation-%26-fiber.md#phases\"\u003e\u003c/a\u003ePhases\u003c/h1\u003e\n\u003ch2\u003e\u003ca href=\"https://github.com/kooku94/kooku-s-log/blob/master/content/blog/react/react-reconciliation-%26-fiber.md#phase-1-render--reconciliation\"\u003e\u003c/a\u003ePhase 1 (render / reconciliation)\u003c/h2\u003e\n\u003cp\u003einterrupible\u003c/p\u003e\n\u003ch2\u003e\u003ca href=\"https://github.com/kooku94/kooku-s-log/blob/master/content/blog/react/react-reconciliation-%26-fiber.md#phase-2-commit\"\u003e\u003c/a\u003ePhase 2 (commit)\u003c/h2\u003e\n\u003cp\u003eno interruptible\u003c/p\u003e\n\u003ch2\u003e\u003ca href=\"https://github.com/kooku94/kooku-s-log/blob/master/content/blog/react/react-reconciliation-%26-fiber.md#reference\"\u003e\u003c/a\u003eReference\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://ko.reactjs.org/docs/reconciliation.html\"\u003ereact - reconciliation\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://www.youtube.com/watch?v=ZCuYPiUIONs\"\u003eLin Clark - A Cartoon Intro to Fiber - React Conf 2017\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/acdlite/react-fiber-architecture\"\u003ereact-fiber-architecture\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e","cover":"/images/react-fiber-cover.jpeg","tags":[{"slug":"react","name":"React"}]}},"__N_SSG":true},"page":"/posts/[slug]","query":{"slug":"react-fiber"},"buildId":"pTmVwASoqRJyt-XjZK8ws","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-ff94e68042added27a93.js"></script><script src="/_next/static/chunks/main-6ea43f52d44630a19477.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.b4f0be21e3e8c82dd407.js" async=""></script><script src="/_next/static/chunks/b6d3ae6728fbe7f18c7a496885d917c502ef8a97.f1fb57fac8faffcae7e5.js" async=""></script><script src="/_next/static/chunks/82588f7d1c9cede2e30aa92ab94d8815bd9a75a3.d8beab73fc47c8ecaab9.js" async=""></script><script src="/_next/static/chunks/pages/_app-2cd9b9378ad45e0c3d1d.js" async=""></script><script src="/_next/static/chunks/b2e984c5.dde205419b836c367968.js" async=""></script><script src="/_next/static/chunks/2c3b9bffc7150b37a7b3810dfcf1c0b0fac2bd18.0d2a9ee544564bfee014.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-dc9389b4382be6e937d8.js" async=""></script><script src="/_next/static/pTmVwASoqRJyt-XjZK8ws/_buildManifest.js" async=""></script><script src="/_next/static/pTmVwASoqRJyt-XjZK8ws/_ssgManifest.js" async=""></script></body></html>
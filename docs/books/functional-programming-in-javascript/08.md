---
title: 8장 비동기 이벤트와 데이터를 관리
---

:::info 이 장의 내용

- 비동기 코드 개발의 어려움
- 함수형 기법으로 중첩된 콜백 사용을 막음
- 프라미스를 응용하여 비동기 코드를 능률화
- 함수 제너레이터로 데이터를 느긋하게 만듦
- 리액티브 프로그래밍 입문
- 리액티브 프로그래밍을 적용한 이벤트 중심 코드

:::

:::note 존 휴스, 1989년 논문에서

<div style={{ textAlign: 'center' }}>함수형 프로그래머는 함수형 프로그래밍이 엄청나게 유익하다고 주장합니다<br/>기존 프로그램보다 한 자릿수나 더 쩗은 함수형 프로그램이<br/>생산성은 외려 한 자릿수 더 생산적이라고 하지요.</div>

:::

## 8.1 골칫덩이 비동기 코드

비동기 코드는 다음의 문제가 있습니다.

- 함수 간에 일시적 의존 관계가 형성
- 어쩔 수 없이 콜백 피라미드의 늪에 빠짐
- 동기/비동기 코드의 호환되지 않는 조합

### 8.1.1 함수 간에 일시적 의존 관계가 형성

AJAX 요청으로 서버에서 학생 객체 리스트를 가져오는 함수가 있다고 합시다. getJSON은 비동기 함수여서 요청을 보내자마자 반환되어 본 프로그램으로 복귀하고 이어서 showStudents 함수를 호출합니다. 하지만 아직 원격 요청은 처리되지 않아 학생 객체는 null인 상태죠. 이벤트가 올바른 순서로 발생하도록 보장하려면 비동기 코드와 그다음 액션 사이에 일시적인 관계를 설정하는 수밖에 없습니다. 즉 showStudent를 콜백 함수 안에 넣는 것입니다.

**일시적 결합**(**일시적 응집**)은 어떤 함수를 논리적으로 묶어 실행할 때 발생합니다. 데이터가 도착할 때까지, 또는 다른 함수가 실행될 때까지 어떤 함수가 기다려야 하는 경우입니다. 데이터든 시간이든 어느 쪽에 의지하는 순간부터 부수효과가 발생합니다.

콜백 함수는 자바스크립트에서 많이 쓰이지만, 대량 데이터를 순차적으로 로드할 경우 확장하기가 어렵고 결국엔 악명 높은 콜백 피라미드에 빠지게 됩니다.

### 8.1.2 콜백 피라미드의 늪에 빠짐

콜백의 주용도는 처리 시간이 오래 걸리는 프로세스를 기다리는 도중 UI를 차단하지 않는 것 입니다. 콜백을 받는 함수는 값을 반환하는 대신 **제어의 역전**을 몸소 실천합니다.

이런 식의 제어의 역전 구조는 함수형 프로그램의 설계 사상과 정면으로 배치됩니다. 함수형 프로그램의 함수는 서로 독립적이며 값을 호출자에 즉시 반환해야 합니다. 게다가 이미 말했듯, 이미 중첩된 콜백에 비동기 로직을 더할 경우 상황은 더 악화됩니다.

```js title="코드 8-3 서버에서 SSN으로 학생 레코드를 조회"
var selector = document.querySelector;
selector('#search-button').addEventListener('click',
  function (event) {
    event.preventDefault();

    let ssn = selector('#student-ssn').value;
    if (!ssn) {
      console.log('경고: 올바른 SSN이 필요합니다!');
      return;
    }
    else {
      getJSON(`/students/${ssn}`, function (info) {
        selector('#student-info').innerHTML = info;
        selector('#student-info').addEventListener('mouseover',
          function() {
            getJSON(`/students/${info.ssn}/grades`,
              function (grades) {
                // ... 학생의 점수 리스트를 처리 ...
              });
          });
      })
      .fail(function() {
        console.log('에러 발생');
      });
    }
  });
```

소스 코드가 이런 모양새를 띄기 시작하면 개발자는 그나마 가독성을 높이고자 공백과 구문 배치에 열중하게 됩니다. 하지만 돼지 목에 진주 목걸이 격이죠.

### 8.1.3 연속체 전달 스타일